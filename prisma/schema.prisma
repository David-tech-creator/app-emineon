generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Candidate {
  id                    String            @id @default(cuid())
  email                 String            @unique
  createdAt             DateTime          @default(now())
  archived              Boolean           @default(false)
  availableFrom         DateTime?
  certifications        String[]
  companies             Json?
  conversionStatus      ConversionStatus?
  culturalFitScore      Float?
  currentLocation       String?
  currentTitle          String?
  degrees               String[]
  educationLevel        EducationLevel?
  expectedSalary        String?
  experienceYears       Int?
  frameworks            String[]
  freelancer            Boolean?          @default(false)
  functionalDomain      String?
  githubUrl             String?
  graduationYear        Int?
  interviewScores       Json?
  lastUpdated           DateTime
  linkedinUrl           String?
  matchingScore         Float?
  methodologies         String[]
  motivationalFitNotes  String?
  nationality           String?
  notableProjects       String[]
  phone                 String?
  portfolioUrl          String?
  preferredContractType ContractType?
  primaryIndustry       String?
  professionalHeadline  String?
  profileToken          String?           @unique
  programmingLanguages  String[]
  recruiterNotes        String[]
  referees              Json?
  relocationWillingness Boolean?          @default(false)
  remotePreference      RemotePreference?
  seniorityLevel        SeniorityLevel?
  softSkills            String[]
  source                String?
  spokenLanguages       String[]
  status                CandidateStatus   @default(NEW)
  summary               String?
  tags                  String[]
  technicalSkills       String[]
  timezone              String?
  toolsAndPlatforms     String[]
  universities          String[]
  videoInterviewUrl     String?
  workPermitType        String?
  firstName             String
  lastName              String
  ai_matches            ai_matches[]
  applications          Application[]
  assessments           assessments[]
  evaluations           evaluations[]
  interviews            interviews[]
  referrals             referrals[]
  sms_messages          sms_messages[]

  @@map("candidates")
}

model Job {
  id                 String               @id @default(cuid())
  title              String
  description        String
  department         String
  location           String
  language           Language             @default(EN)
  status             JobStatus            @default(DRAFT)
  salaryMin          Int?
  salaryMax          Int?
  salaryCurrency     String?              @default("USD")
  experienceLevel    String?
  benefits           String[]
  requirements       String[]
  responsibilities   String[]
  isRemote           Boolean              @default(false)
  publicToken        String?              @unique
  embedCode          String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  publishedAt        DateTime?
  expiresAt          DateTime?
  employmentType     String[]
  ai_matches         ai_matches[]
  applications       Application[]
  interviews         interviews[]
  job_distributions  job_distributions[]
  social_media_posts social_media_posts[]

  @@index([expiresAt])
  @@index([publishedAt])
  @@index([status, department])
  @@index([status, isRemote])
  @@index([status, language])
  @@index([status, location])
  @@index([status, publishedAt])
  @@map("jobs")
}

model Application {
  id           String            @id @default(cuid())
  candidateId  String
  jobId        String
  status       ApplicationStatus @default(PENDING)
  coverLetter  String?
  cvUrl        String?
  referralCode String?
  source       String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime
  candidate    Candidate         @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job          Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([candidateId, jobId])
  @@map("applications")
}

model ai_matches {
  id          String    @id
  jobId       String
  candidateId String
  score       Float
  reasoning   String?
  factors     Json?
  createdAt   DateTime  @default(now())
  candidates  Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  jobs        Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, candidateId])
}

model assessments {
  id          String           @id
  candidateId String
  type        AssessmentType
  questions   Json
  answers     Json?
  score       Float?
  maxScore    Float
  status      AssessmentStatus @default(NOT_STARTED)
  startedAt   DateTime?
  completedAt DateTime?
  expiresAt   DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  candidates  Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model calendar_integrations {
  id           String           @id
  userId       String           @unique
  provider     CalendarProvider
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?
  isActive     Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime
}

model evaluations {
  id          String    @id
  candidateId String
  evaluatorId String
  rating      Float
  notes       String?
  criteria    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  candidates  Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model interviews {
  id                String          @id
  candidateId       String
  jobId             String
  interviewerId     String
  type              InterviewType
  status            InterviewStatus @default(SCHEDULED)
  scheduledAt       DateTime
  duration          Int
  location          String?
  videoInterviewUrl String?
  notes             String?
  rating            Float?
  calendarEventId   String?
  meetingLink       String?
  dialInDetails     String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  candidates        Candidate       @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  jobs              Job             @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model job_distributions {
  id           String             @id
  jobId        String
  platform     String
  status       DistributionStatus
  externalId   String?
  postUrl      String?
  cost         Float?
  postedAt     DateTime?
  expiresAt    DateTime?
  errorCode    String?
  errorMessage String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  jobs         Job                @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model logs {
  id        String   @id
  actor     String?
  action    String
  resource  String
  details   Json?
  level     LogLevel @default(INFO)
  timestamp DateTime @default(now())
}

model referrals {
  id           String         @id
  candidateId  String
  referrerId   String
  referrerName String
  code         String         @unique
  isUsed       Boolean        @default(false)
  reward       Float?
  status       ReferralStatus @default(PENDING)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  candidates   Candidate      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model sms_messages {
  id          String       @id
  candidateId String
  phoneNumber String
  message     String
  status      SmsStatus    @default(PENDING)
  direction   SmsDirection
  externalId  String?
  errorCode   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  candidates  Candidate    @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model social_media_posts {
  id        String         @id
  jobId     String
  platform  SocialPlatform
  content   String
  status    PostStatus
  postUrl   String?
  postId    String?
  createdAt DateTime       @default(now())
  updatedAt DateTime
  jobs      Job            @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model workflow_rules {
  id         String   @id
  name       String
  trigger    String
  conditions Json
  actions    Json
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
}

enum CandidateStatus {
  NEW
  ACTIVE
  PASSIVE
  DO_NOT_CONTACT
  BLACKLISTED
}

enum ContractType {
  PERMANENT
  FREELANCE
  FIXED_TERM
  CONTRACT
  INTERNSHIP
}

enum JobStatus {
  DRAFT
  ACTIVE
  PAUSED
  CLOSED
  ARCHIVED
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEW_SCHEDULED
  INTERVIEWED
  OFFER_EXTENDED
  HIRED
  REJECTED
  WITHDRAWN
}

enum AssessmentStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  EXPIRED
  CANCELLED
}

enum AssessmentType {
  TECHNICAL
  PERSONALITY
  COGNITIVE
  SKILLS_BASED
  CUSTOM
}

enum CalendarProvider {
  GOOGLE
  OUTLOOK
  APPLE
}

enum ConversionStatus {
  IN_PIPELINE
  PLACED
  REJECTED
  WITHDRAWN
  ON_HOLD
}

enum DataSource {
  MANUAL
  LINKEDIN
  INDEED
  GLASSDOOR
  REFERRAL
  WEBSITE
  API_IMPORT
  BULK_UPLOAD
  AI_SOURCED
}

enum DistributionStatus {
  PENDING
  POSTED
  FAILED
  EXPIRED
  REMOVED
}

enum EducationLevel {
  HIGH_SCHOOL
  ASSOCIATE
  BACHELOR
  MASTER
  PHD
  CERTIFICATION
  BOOTCAMP
  SELF_TAUGHT
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  FREELANCE
  INTERNSHIP
  TEMPORARY
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum InterviewType {
  PHONE_SCREENING
  TECHNICAL
  BEHAVIORAL
  FINAL
  VIDEO_ONE_WAY
}

enum Language {
  EN
  ES
  FR
  DE
  PT
  IT
  NL
  PL
  RU
  ZH
  JA
  KO
}

enum LogLevel {
  INFO
  WARN
  ERROR
  DEBUG
}

enum NoticePeriod {
  IMMEDIATE
  ONE_WEEK
  TWO_WEEKS
  ONE_MONTH
  TWO_MONTHS
  THREE_MONTHS
  SIX_MONTHS
  OTHER
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  FAILED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReferralStatus {
  PENDING
  APPROVED
  PAID
  REJECTED
}

enum RemotePreference {
  REMOTE
  HYBRID
  ONSITE
  FLEXIBLE
}

enum SalaryType {
  ANNUAL
  MONTHLY
  DAILY
  HOURLY
}

enum SeniorityLevel {
  INTERN
  JUNIOR
  MID_LEVEL
  SENIOR
  LEAD
  PRINCIPAL
  ARCHITECT
  DIRECTOR
  VP
  C_LEVEL
}

enum SmsDirection {
  OUTBOUND
  INBOUND
}

enum SmsStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  REPLIED
}

enum SocialPlatform {
  LINKEDIN
  TWITTER
  FACEBOOK
  INSTAGRAM
}

enum TravelWillingness {
  NONE
  OCCASIONAL
  FREQUENT
  EXTENSIVE
  INTERNATIONAL
}

enum WorkAuthStatus {
  CITIZEN
  PERMANENT_RESIDENT
  WORK_VISA
  STUDENT_VISA
  REQUIRES_SPONSORSHIP
  NOT_AUTHORIZED
}

enum WorkSchedule {
  FULL_TIME
  PART_TIME
  FLEXIBLE
  SHIFT_WORK
  COMPRESSED
  JOB_SHARE
}
